<!DOCTYPE html>
<h3 style="margin:0 0 .6rem 0">เลือกแถวที่จะลบ (Cloud)</h3>
<div id="deleteList" style="display:flex;flex-direction:column;gap:.5rem;max-height:60vh;overflow:auto"></div>
<div style="display:flex;gap:.5rem;margin-top:.75rem;justify-content:flex-end">
<button id="deleteSelectedBtn" class="danger">Delete Selected</button>
<button id="deleteAllBtn" class="danger secondary">Delete All</button>
<button id="cancelDeleteBtn" class="primary">Cancel</button>
</div>
</div>
</div>


<!-- Firebase (modular v10) -->
<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
import { getDatabase, ref, set, get, remove, onValue, off } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js';


const firebaseConfig = {
apiKey: "AIzaSyBje0eYhaR5NkyQqD9Kzh42htSTsU6iKWw",
authDomain: "expense-sync-realtime.firebaseapp.com",
databaseURL: "https://expense-sync-realtime-default-rtdb.asia-southeast1.firebasedatabase.app",
projectId: "expense-sync-realtime",
storageBucket: "expense-sync-realtime.firebasestorage.app",
messagingSenderId: "1054304195925",
appId: "1:1054304195925:web:75246d2f8de1d0a761cbdc"
};


const app = initializeApp(firebaseConfig);
const db = getDatabase(app);


const KEY = 'expense_share_id';
const shortId = () => Math.random().toString(36).slice(2, 8);


let liveUnsubscribe = null;


window.fb = {
getLocalId() { return localStorage.getItem(KEY); },
setLocalId(id) { localStorage.setItem(KEY, id); },
async write(payload) {
let id = localStorage.getItem(KEY);
if (!id) { id = shortId(); localStorage.setItem(KEY, id); }
await set(ref(db, 'shares/' + id), { payload, ts: Date.now() });
return id;
},
async read(id) {
const snap = await get(ref(db, 'shares/' + id));
return snap.exists() ? snap.val().payload : null;
},
async del(id) {
await remove(ref(db, 'shares/' + id));
if (localStorage.getItem(KEY) === id) localStorage.removeItem(KEY);
},
onLive(id, cb) {
if (liveUnsubscribe) liveUnsubscribe();
const r = ref(db, 'shares/' + id);
const handler = (s) => cb(s.val() && s.val().payload ? s.val().payload : null);
onValue(r, handler);
liveUnsubscribe = () => off(r, 'value', handler);
return liveUnsubscribe;
}
};
</script>


<!-- โหลด Chart.js แบบ defer และสคริปต์หลัก -->
<script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script defer src="script.js"></script>
</body>
</html>
